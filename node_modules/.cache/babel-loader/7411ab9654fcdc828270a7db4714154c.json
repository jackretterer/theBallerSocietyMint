{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.reducer = void 0;\n\nconst react_1 = require(\"react\");\n\nconst logger_1 = __importDefault(require(\"../logger\"));\n\nconst types_1 = require(\"../types\");\n\nconst config_1 = require(\"../config\");\n\nconst utils_1 = require(\"../useReducer/utils\");\n\nconst gatewayStatusToCivicPassAction = {\n  [types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP]: types_1.CivicPassMessageAction.PROOF_OF_WALLET_OWNERSHIP,\n  [types_1.GatewayStatus.IN_REVIEW]: types_1.CivicPassMessageAction.TOKEN_IN_REVIEW,\n  [types_1.GatewayStatus.ERROR]: types_1.CivicPassMessageAction.ISSUANCE,\n  [types_1.GatewayStatus.ACTIVE]: types_1.CivicPassMessageAction.TOKEN_ACTIVE,\n  [types_1.GatewayStatus.REVOKED]: types_1.CivicPassMessageAction.TOKEN_REVOKED,\n  [types_1.GatewayStatus.FROZEN]: types_1.CivicPassMessageAction.TOKEN_FROZEN,\n  [types_1.GatewayStatus.REJECTED]: types_1.CivicPassMessageAction.TOKEN_REJECTED,\n  [types_1.GatewayStatus.LOCATION_NOT_SUPPORTED]: types_1.CivicPassMessageAction.FAILED_IP_CHECK,\n  [types_1.GatewayStatus.VPN_NOT_SUPPORTED]: types_1.CivicPassMessageAction.FAILED_VPN_CHECK,\n  [types_1.GatewayStatus.REFRESH_TOKEN_REQUIRED]: types_1.CivicPassMessageAction.REFRESH,\n  [types_1.GatewayStatus.CHECKING]: types_1.CivicPassMessageAction.STATUS,\n  [types_1.GatewayStatus.NOT_REQUESTED]: types_1.CivicPassMessageAction.ISSUANCE,\n  [types_1.GatewayStatus.COLLECTING_USER_INFORMATION]: types_1.CivicPassMessageAction.ISSUANCE,\n  [types_1.GatewayStatus.VALIDATING_USER_INFORMATION]: types_1.CivicPassMessageAction.ISSUANCE,\n  [types_1.GatewayStatus.USER_INFORMATION_VALIDATED]: types_1.CivicPassMessageAction.ISSUANCE,\n  [types_1.GatewayStatus.USER_INFORMATION_REJECTED]: types_1.CivicPassMessageAction.ISSUANCE\n};\nconst validationProcessToGatewayStatus = {\n  [types_1.ValidationStatus.COLLECTING]: types_1.GatewayStatus.COLLECTING_USER_INFORMATION,\n  [types_1.ValidationStatus.PROCESSING]: types_1.GatewayStatus.VALIDATING_USER_INFORMATION,\n  [types_1.ValidationStatus.IN_REVIEW]: types_1.GatewayStatus.VALIDATING_USER_INFORMATION,\n  [types_1.ValidationStatus.FAILED]: types_1.GatewayStatus.USER_INFORMATION_REJECTED,\n  [types_1.ValidationStatus.NOT_FOUND]: types_1.GatewayStatus.NOT_REQUESTED,\n  [types_1.ValidationStatus.COMPLETED]: types_1.GatewayStatus.USER_INFORMATION_VALIDATED\n};\n\nconst logDebug = function (message) {\n  let obj = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  return logger_1.default.debug(`[useCivicPass] ${message}`, obj);\n};\n\nconst logError = function (message) {\n  let obj = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  return logger_1.default.error(`[useCivicPass] ${message}`, obj);\n}; // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\n\nconst getCivicPassSrcUrl = (state, status) => {\n  const {\n    redirectUrl,\n    gatekeeperNetworkAddress,\n    stage,\n    walletAddress,\n    civicPass,\n    chainType\n  } = state;\n\n  if (!gatekeeperNetworkAddress || !walletAddress) {\n    logError('Required properties not present', {\n      gatekeeperNetworkAddress,\n      walletAddress\n    });\n    throw new Error(`Required properties not present ${{\n      gatekeeperNetworkAddress,\n      walletAddress\n    }}`);\n  }\n\n  const civicPassSrcUrl = (0, config_1.getCivicPassEndpoint)(stage);\n  const url = new URL(civicPassSrcUrl);\n  const action = gatewayStatusToCivicPassAction[status];\n  const searchParams = new URLSearchParams(Object.assign(Object.assign({}, civicPass.requestPayload), {\n    redirectUrl,\n    networkAddress: gatekeeperNetworkAddress,\n    action,\n    wallet: walletAddress,\n    chain: chainType\n  }));\n  logDebug('Civic pass query params', {\n    searchParams: searchParams.toString(),\n    gatewayStatus: types_1.GatewayStatus[status]\n  });\n  return `${url.href}?${searchParams.toString()}`;\n};\n\nconst reducer = (state, action) => {\n  var _a;\n\n  switch (action.type) {\n    case 'civicPass_check_token_status':\n      {\n        return Object.assign(Object.assign({}, state), {\n          iframeMinimized: !((_a = state.options) === null || _a === void 0 ? void 0 : _a.autoShowModal),\n          renderIframe: true,\n          iframeSrcUrl: state.civicPass.status === types_1.CivicPassIssuanceStatus.REQUESTED ? state.iframeSrcUrl : getCivicPassSrcUrl(state, (0, utils_1.statusFromToken)(state, action.token))\n        });\n      }\n\n    case 'civicPass_check_status':\n      {\n        return Object.assign(Object.assign({}, state), {\n          iframeMinimized: true,\n          renderIframe: true,\n          gatewayStatus: types_1.GatewayStatus.CHECKING,\n          iframeSrcUrl: getCivicPassSrcUrl(state, types_1.GatewayStatus.CHECKING)\n        });\n      }\n\n    case 'civicPass_check_status_complete':\n      {\n        const {\n          payload\n        } = action.payload;\n        const {\n          status\n        } = payload;\n        const gatewayStatus = validationProcessToGatewayStatus[status];\n        return Object.assign(Object.assign({}, state), {\n          iframeMinimized: true,\n          renderIframe: false,\n          gatewayStatus\n        });\n      }\n\n    case 'userInteraction_check_gatewayToken_status':\n      {\n        return Object.assign(Object.assign({}, state), {\n          iframeMinimized: false,\n          renderIframe: true,\n          iframeSrcUrl: state.civicPass.status === types_1.CivicPassIssuanceStatus.REQUESTED ? state.iframeSrcUrl : getCivicPassSrcUrl(state, (0, utils_1.statusFromToken)(state, action.token))\n        });\n      }\n\n    case 'civicPass_close':\n      {\n        const {\n          gatewayStatus\n        } = state;\n        const requiresRefresh = gatewayStatus === types_1.GatewayStatus.REFRESH_TOKEN_REQUIRED || gatewayStatus === types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP;\n        return Object.assign({}, state.civicPass.status === types_1.CivicPassIssuanceStatus.REQUESTED ? Object.assign(Object.assign({}, state), {\n          iframeMinimized: true,\n          renderIframe: true\n        }) : Object.assign(Object.assign({}, state), {\n          iframeMinimized: true,\n          renderIframe: false,\n          refreshTokenState: requiresRefresh ? state.refreshTokenState : types_1.RefreshTokenState.COMPLETED\n        }));\n      }\n\n    case 'civicPass_in_progress':\n      {\n        return Object.assign(Object.assign({}, state), {\n          gatewayStatus: types_1.GatewayStatus.COLLECTING_USER_INFORMATION,\n          renderIframe: true,\n          iframeMinimized: false,\n          civicPass: Object.assign(Object.assign({}, state.civicPass), {\n            status: types_1.CivicPassIssuanceStatus.REQUESTED\n          })\n        });\n      }\n\n    case 'civicPass_issuance_success':\n      {\n        const {\n          ownerSigns\n        } = state;\n        const {\n          payload,\n          requiresProofOfWalletOwnership\n        } = action.payload;\n        const shouldRequestPowo = ownerSigns ? false : requiresProofOfWalletOwnership;\n        const gatewayStatus = shouldRequestPowo ? types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP : types_1.GatewayStatus.IN_REVIEW;\n        return Object.assign(Object.assign({}, state), {\n          gatewayStatus,\n          renderIframe: !ownerSigns,\n          iframeMinimized: ownerSigns,\n          powoRequested: 'solana',\n          iframeSrcUrl: getCivicPassSrcUrl(state, gatewayStatus),\n          civicPass: Object.assign(Object.assign({}, state.civicPass), {\n            status: types_1.CivicPassIssuanceStatus.VERIFIED,\n            responsePayload: {\n              [types_1.CivicPassMessageAction.ISSUANCE]: {\n                payload,\n                requiresProofOfWalletOwnership: shouldRequestPowo\n              }\n            }\n          })\n        });\n      }\n\n    case 'civicPass_issuance_failure':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        gatewayStatus: types_1.GatewayStatus.ERROR\n      });\n\n    case 'civicPass_issuance_cancelled':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        gatewayStatus: types_1.GatewayStatus.NOT_REQUESTED\n      });\n\n    case 'civicPass_refresh_success':\n      {\n        const {\n          ownerSigns\n        } = state;\n        const {\n          payload,\n          requiresProofOfWalletOwnership\n        } = action.payload;\n        const shouldRequestPowo = ownerSigns ? false : requiresProofOfWalletOwnership;\n        const gatewayStatus = shouldRequestPowo ? types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP : types_1.GatewayStatus.IN_REVIEW;\n        return Object.assign(Object.assign({}, state), {\n          gatewayStatus,\n          renderIframe: !ownerSigns,\n          iframeMinimized: ownerSigns,\n          iframeSrcUrl: getCivicPassSrcUrl(state, gatewayStatus),\n          refreshTokenState: types_1.RefreshTokenState.IN_PROGRESS,\n          civicPass: Object.assign(Object.assign({}, state.civicPass), {\n            responsePayload: {\n              [types_1.CivicPassMessageAction.REFRESH]: {\n                payload,\n                requiresProofOfWalletOwnership: shouldRequestPowo\n              }\n            }\n          })\n        });\n      }\n\n    case 'civicPass_refresh_cancelled':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        refreshTokenState: types_1.RefreshTokenState.CANCELLED,\n        gatewayStatus: types_1.GatewayStatus.REFRESH_TOKEN_REQUIRED\n      });\n\n    case 'civicPass_refresh_failure':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        refreshTokenState: types_1.RefreshTokenState.FAILED,\n        gatewayStatus: types_1.GatewayStatus.ERROR,\n        civicPass: Object.assign(Object.assign({}, state.civicPass), {\n          responsePayload: undefined\n        })\n      });\n\n    case 'civicPass_location_not_supported':\n      return Object.assign(Object.assign({}, state), {\n        iframeMinimized: true,\n        renderIframe: false,\n        gatewayStatus: state.gatewayStatus,\n        refreshTokenState: state.gatekeeperRecordState === types_1.GatekeeperRecordState.ISSUED_LOCATION_NOT_SUPPORTED ? types_1.RefreshTokenState.REQUIRES_POWO : state.refreshTokenState\n      });\n\n    case 'civicPass_vpn_not_supported':\n      return Object.assign(Object.assign({}, state), {\n        iframeMinimized: true,\n        renderIframe: false,\n        gatewayStatus: state.gatewayStatus\n      });\n\n    default:\n      return state;\n  }\n};\n\nexports.reducer = reducer;\n\nconst useCivicPass = (_ref, state, dispatch) => {\n  let {\n    wallet\n  } = _ref;\n  const {\n    gatekeeperRecordState\n  } = state;\n\n  const getActionForIssuanceResponse = response => {\n    const actions = {\n      [types_1.CivicPassMessageEventResult.SUCCESS]: {\n        type: 'civicPass_issuance_success',\n        payload: response\n      },\n      [types_1.CivicPassMessageEventResult.FAILURE]: {\n        type: 'civicPass_issuance_failure'\n      },\n      [types_1.CivicPassMessageEventResult.CANCELLED]: {\n        type: 'civicPass_issuance_cancelled'\n      },\n      [types_1.CivicPassMessageEventResult.IN_PROGRESS]: {\n        type: 'civicPass_in_progress'\n      }\n    };\n    return actions[response.event];\n  };\n\n  const getActionForRefreshResponse = response => {\n    const actions = {\n      [types_1.CivicPassMessageEventResult.SUCCESS]: {\n        type: 'civicPass_refresh_success',\n        payload: response\n      },\n      [types_1.CivicPassMessageEventResult.CANCELLED]: {\n        type: 'civicPass_refresh_cancelled'\n      },\n      [types_1.CivicPassMessageEventResult.FAILURE]: {\n        type: 'civicPass_refresh_failure'\n      }\n    };\n    return actions[response.event];\n  };\n\n  const getActionForPowoResponse = response => {\n    const actions = {\n      [types_1.CivicPassMessageEventResult.SUCCESS]: {\n        type: 'powoComplete'\n      }\n    };\n    return actions[response.event];\n  };\n\n  const getActionForLocationNotSupportedResponse = response => {\n    const actions = {\n      [types_1.CivicPassMessageEventResult.SUCCESS]: {\n        type: 'civicPass_location_not_supported'\n      }\n    };\n    return actions[response.event];\n  };\n\n  const getActionForVpnNotSupportedResponse = response => {\n    const actions = {\n      [types_1.CivicPassMessageEventResult.SUCCESS]: {\n        type: 'civicPass_vpn_not_supported'\n      }\n    };\n    return actions[response.event];\n  };\n\n  const getActionForStaticResponse = response => {\n    const actions = {\n      [types_1.CivicPassMessageEventResult.SUCCESS]: {\n        type: 'civicPass_close'\n      }\n    };\n    return actions[response.event];\n  };\n\n  const getActionForStatusResponse = response => {\n    const actions = {\n      [types_1.CivicPassMessageEventResult.SUCCESS]: {\n        type: 'civicPass_check_status_complete',\n        payload: response\n      }\n    };\n    return actions[response.event];\n  };\n\n  const dispatchComplianceEventResult = response => {\n    const actions = {\n      [types_1.CivicPassMessageAction.ISSUANCE]: getActionForIssuanceResponse(response),\n      [types_1.CivicPassMessageAction.PROOF_OF_WALLET_OWNERSHIP]: getActionForPowoResponse(response),\n      [types_1.CivicPassMessageAction.TOKEN_IN_REVIEW]: getActionForStaticResponse(response),\n      [types_1.CivicPassMessageAction.TOKEN_ACTIVE]: getActionForStaticResponse(response),\n      [types_1.CivicPassMessageAction.TOKEN_FROZEN]: getActionForStaticResponse(response),\n      [types_1.CivicPassMessageAction.TOKEN_REJECTED]: getActionForStaticResponse(response),\n      [types_1.CivicPassMessageAction.TOKEN_REVOKED]: getActionForStaticResponse(response),\n      [types_1.CivicPassMessageAction.FAILED_IP_CHECK]: getActionForLocationNotSupportedResponse(response),\n      [types_1.CivicPassMessageAction.FAILED_VPN_CHECK]: getActionForVpnNotSupportedResponse(response),\n      [types_1.CivicPassMessageAction.REFRESH]: getActionForRefreshResponse(response),\n      [types_1.CivicPassMessageAction.STATUS]: getActionForStatusResponse(response)\n    };\n    const action = actions[response.action];\n\n    if (action) {\n      logDebug('Successfully processed compliance event with action', action);\n      dispatch(action);\n    }\n  };\n  /**\n   * Listen for post messages from the compliance iframe and dispatch events\n   * based on the event type\n   */\n\n\n  (0, react_1.useEffect)(() => {\n    if (wallet && wallet.publicKey) {\n      logDebug('Current state', state);\n\n      const handler = async response => {\n        dispatchComplianceEventResult(response.data);\n      };\n\n      window.addEventListener('message', handler);\n      return () => {\n        logDebug('Removing event listener for compliance');\n        return window.removeEventListener('message', handler);\n      };\n    }\n\n    return () => {};\n  }, []);\n  /**\n   * We do not have a token and user is connecting from an unsupported country,\n   * so we show the country not supported screen\n   */\n\n  (0, react_1.useEffect)(() => {\n    if (gatekeeperRecordState === types_1.GatekeeperRecordState.LOCATION_NOT_SUPPORTED || gatekeeperRecordState === types_1.GatekeeperRecordState.VPN_NOT_SUPPORTED) {\n      dispatch({\n        type: 'civicPass_check_token_status'\n      });\n    }\n  }, [gatekeeperRecordState]);\n  /**\n   * Check for the ongoing KYC status\n   */\n\n  (0, react_1.useEffect)(() => {\n    if (gatekeeperRecordState === types_1.GatekeeperRecordState.NOT_REQUESTED) {\n      dispatch({\n        type: 'civicPass_check_status'\n      });\n    }\n  }, [gatekeeperRecordState]);\n  return {\n    dispatchComplianceEventResult\n  };\n};\n\nexports.default = useCivicPass;","map":{"version":3,"sources":["/Users/jackretterer/metaplex/js/packages/candy-machine-ui/node_modules/@civic/solana-gateway-react/dist/esm/useHooks/useCivicPass.js"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","reducer","react_1","require","logger_1","types_1","config_1","utils_1","gatewayStatusToCivicPassAction","GatewayStatus","PROOF_OF_WALLET_OWNERSHIP","CivicPassMessageAction","IN_REVIEW","TOKEN_IN_REVIEW","ERROR","ISSUANCE","ACTIVE","TOKEN_ACTIVE","REVOKED","TOKEN_REVOKED","FROZEN","TOKEN_FROZEN","REJECTED","TOKEN_REJECTED","LOCATION_NOT_SUPPORTED","FAILED_IP_CHECK","VPN_NOT_SUPPORTED","FAILED_VPN_CHECK","REFRESH_TOKEN_REQUIRED","REFRESH","CHECKING","STATUS","NOT_REQUESTED","COLLECTING_USER_INFORMATION","VALIDATING_USER_INFORMATION","USER_INFORMATION_VALIDATED","USER_INFORMATION_REJECTED","validationProcessToGatewayStatus","ValidationStatus","COLLECTING","PROCESSING","FAILED","NOT_FOUND","COMPLETED","logDebug","message","obj","default","debug","logError","error","getCivicPassSrcUrl","state","status","redirectUrl","gatekeeperNetworkAddress","stage","walletAddress","civicPass","chainType","Error","civicPassSrcUrl","getCivicPassEndpoint","url","URL","action","searchParams","URLSearchParams","assign","requestPayload","networkAddress","wallet","chain","toString","gatewayStatus","href","_a","type","iframeMinimized","options","autoShowModal","renderIframe","iframeSrcUrl","CivicPassIssuanceStatus","REQUESTED","statusFromToken","token","payload","requiresRefresh","refreshTokenState","RefreshTokenState","ownerSigns","requiresProofOfWalletOwnership","shouldRequestPowo","powoRequested","VERIFIED","responsePayload","resetState","IN_PROGRESS","CANCELLED","undefined","gatekeeperRecordState","GatekeeperRecordState","ISSUED_LOCATION_NOT_SUPPORTED","REQUIRES_POWO","useCivicPass","dispatch","getActionForIssuanceResponse","response","actions","CivicPassMessageEventResult","SUCCESS","FAILURE","event","getActionForRefreshResponse","getActionForPowoResponse","getActionForLocationNotSupportedResponse","getActionForVpnNotSupportedResponse","getActionForStaticResponse","getActionForStatusResponse","dispatchComplianceEventResult","useEffect","publicKey","handler","data","window","addEventListener","removeEventListener"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.reducer = void 0;\nconst react_1 = require(\"react\");\nconst logger_1 = __importDefault(require(\"../logger\"));\nconst types_1 = require(\"../types\");\nconst config_1 = require(\"../config\");\nconst utils_1 = require(\"../useReducer/utils\");\nconst gatewayStatusToCivicPassAction = {\n    [types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP]: types_1.CivicPassMessageAction.PROOF_OF_WALLET_OWNERSHIP,\n    [types_1.GatewayStatus.IN_REVIEW]: types_1.CivicPassMessageAction.TOKEN_IN_REVIEW,\n    [types_1.GatewayStatus.ERROR]: types_1.CivicPassMessageAction.ISSUANCE,\n    [types_1.GatewayStatus.ACTIVE]: types_1.CivicPassMessageAction.TOKEN_ACTIVE,\n    [types_1.GatewayStatus.REVOKED]: types_1.CivicPassMessageAction.TOKEN_REVOKED,\n    [types_1.GatewayStatus.FROZEN]: types_1.CivicPassMessageAction.TOKEN_FROZEN,\n    [types_1.GatewayStatus.REJECTED]: types_1.CivicPassMessageAction.TOKEN_REJECTED,\n    [types_1.GatewayStatus.LOCATION_NOT_SUPPORTED]: types_1.CivicPassMessageAction.FAILED_IP_CHECK,\n    [types_1.GatewayStatus.VPN_NOT_SUPPORTED]: types_1.CivicPassMessageAction.FAILED_VPN_CHECK,\n    [types_1.GatewayStatus.REFRESH_TOKEN_REQUIRED]: types_1.CivicPassMessageAction.REFRESH,\n    [types_1.GatewayStatus.CHECKING]: types_1.CivicPassMessageAction.STATUS,\n    [types_1.GatewayStatus.NOT_REQUESTED]: types_1.CivicPassMessageAction.ISSUANCE,\n    [types_1.GatewayStatus.COLLECTING_USER_INFORMATION]: types_1.CivicPassMessageAction.ISSUANCE,\n    [types_1.GatewayStatus.VALIDATING_USER_INFORMATION]: types_1.CivicPassMessageAction.ISSUANCE,\n    [types_1.GatewayStatus.USER_INFORMATION_VALIDATED]: types_1.CivicPassMessageAction.ISSUANCE,\n    [types_1.GatewayStatus.USER_INFORMATION_REJECTED]: types_1.CivicPassMessageAction.ISSUANCE,\n};\nconst validationProcessToGatewayStatus = {\n    [types_1.ValidationStatus.COLLECTING]: types_1.GatewayStatus.COLLECTING_USER_INFORMATION,\n    [types_1.ValidationStatus.PROCESSING]: types_1.GatewayStatus.VALIDATING_USER_INFORMATION,\n    [types_1.ValidationStatus.IN_REVIEW]: types_1.GatewayStatus.VALIDATING_USER_INFORMATION,\n    [types_1.ValidationStatus.FAILED]: types_1.GatewayStatus.USER_INFORMATION_REJECTED,\n    [types_1.ValidationStatus.NOT_FOUND]: types_1.GatewayStatus.NOT_REQUESTED,\n    [types_1.ValidationStatus.COMPLETED]: types_1.GatewayStatus.USER_INFORMATION_VALIDATED,\n};\nconst logDebug = (message, obj = null) => logger_1.default.debug(`[useCivicPass] ${message}`, obj);\nconst logError = (message, obj = null) => logger_1.default.error(`[useCivicPass] ${message}`, obj);\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nconst getCivicPassSrcUrl = (state, status) => {\n    const { redirectUrl, gatekeeperNetworkAddress, stage, walletAddress, civicPass, chainType } = state;\n    if (!gatekeeperNetworkAddress || !walletAddress) {\n        logError('Required properties not present', { gatekeeperNetworkAddress, walletAddress });\n        throw new Error(`Required properties not present ${{ gatekeeperNetworkAddress, walletAddress }}`);\n    }\n    const civicPassSrcUrl = (0, config_1.getCivicPassEndpoint)(stage);\n    const url = new URL(civicPassSrcUrl);\n    const action = gatewayStatusToCivicPassAction[status];\n    const searchParams = new URLSearchParams(Object.assign(Object.assign({}, civicPass.requestPayload), { redirectUrl, networkAddress: gatekeeperNetworkAddress, action, wallet: walletAddress, chain: chainType }));\n    logDebug('Civic pass query params', { searchParams: searchParams.toString(), gatewayStatus: types_1.GatewayStatus[status] });\n    return `${url.href}?${searchParams.toString()}`;\n};\nconst reducer = (state, action) => {\n    var _a;\n    switch (action.type) {\n        case 'civicPass_check_token_status': {\n            return Object.assign(Object.assign({}, state), { iframeMinimized: !((_a = state.options) === null || _a === void 0 ? void 0 : _a.autoShowModal), renderIframe: true, iframeSrcUrl: state.civicPass.status === types_1.CivicPassIssuanceStatus.REQUESTED\n                    ? state.iframeSrcUrl\n                    : getCivicPassSrcUrl(state, (0, utils_1.statusFromToken)(state, action.token)) });\n        }\n        case 'civicPass_check_status': {\n            return Object.assign(Object.assign({}, state), { iframeMinimized: true, renderIframe: true, gatewayStatus: types_1.GatewayStatus.CHECKING, iframeSrcUrl: getCivicPassSrcUrl(state, types_1.GatewayStatus.CHECKING) });\n        }\n        case 'civicPass_check_status_complete': {\n            const { payload } = action.payload;\n            const { status } = payload;\n            const gatewayStatus = validationProcessToGatewayStatus[status];\n            return Object.assign(Object.assign({}, state), { iframeMinimized: true, renderIframe: false, gatewayStatus });\n        }\n        case 'userInteraction_check_gatewayToken_status': {\n            return Object.assign(Object.assign({}, state), { iframeMinimized: false, renderIframe: true, iframeSrcUrl: state.civicPass.status === types_1.CivicPassIssuanceStatus.REQUESTED\n                    ? state.iframeSrcUrl\n                    : getCivicPassSrcUrl(state, (0, utils_1.statusFromToken)(state, action.token)) });\n        }\n        case 'civicPass_close': {\n            const { gatewayStatus } = state;\n            const requiresRefresh = gatewayStatus === types_1.GatewayStatus.REFRESH_TOKEN_REQUIRED ||\n                gatewayStatus === types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP;\n            return Object.assign({}, (state.civicPass.status === types_1.CivicPassIssuanceStatus.REQUESTED\n                ? Object.assign(Object.assign({}, state), { iframeMinimized: true, renderIframe: true }) : Object.assign(Object.assign({}, state), { iframeMinimized: true, renderIframe: false, refreshTokenState: requiresRefresh ? state.refreshTokenState : types_1.RefreshTokenState.COMPLETED })));\n        }\n        case 'civicPass_in_progress': {\n            return Object.assign(Object.assign({}, state), { gatewayStatus: types_1.GatewayStatus.COLLECTING_USER_INFORMATION, renderIframe: true, iframeMinimized: false, civicPass: Object.assign(Object.assign({}, state.civicPass), { status: types_1.CivicPassIssuanceStatus.REQUESTED }) });\n        }\n        case 'civicPass_issuance_success': {\n            const { ownerSigns } = state;\n            const { payload, requiresProofOfWalletOwnership } = action.payload;\n            const shouldRequestPowo = ownerSigns ? false : requiresProofOfWalletOwnership;\n            const gatewayStatus = shouldRequestPowo ? types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP : types_1.GatewayStatus.IN_REVIEW;\n            return Object.assign(Object.assign({}, state), { gatewayStatus, renderIframe: !ownerSigns, iframeMinimized: ownerSigns, powoRequested: 'solana', iframeSrcUrl: getCivicPassSrcUrl(state, gatewayStatus), civicPass: Object.assign(Object.assign({}, state.civicPass), { status: types_1.CivicPassIssuanceStatus.VERIFIED, responsePayload: {\n                        [types_1.CivicPassMessageAction.ISSUANCE]: {\n                            payload,\n                            requiresProofOfWalletOwnership: shouldRequestPowo,\n                        },\n                    } }) });\n        }\n        case 'civicPass_issuance_failure':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { gatewayStatus: types_1.GatewayStatus.ERROR });\n        case 'civicPass_issuance_cancelled':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { gatewayStatus: types_1.GatewayStatus.NOT_REQUESTED });\n        case 'civicPass_refresh_success': {\n            const { ownerSigns } = state;\n            const { payload, requiresProofOfWalletOwnership } = action.payload;\n            const shouldRequestPowo = ownerSigns ? false : requiresProofOfWalletOwnership;\n            const gatewayStatus = shouldRequestPowo ? types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP : types_1.GatewayStatus.IN_REVIEW;\n            return Object.assign(Object.assign({}, state), { gatewayStatus, renderIframe: !ownerSigns, iframeMinimized: ownerSigns, iframeSrcUrl: getCivicPassSrcUrl(state, gatewayStatus), refreshTokenState: types_1.RefreshTokenState.IN_PROGRESS, civicPass: Object.assign(Object.assign({}, state.civicPass), { responsePayload: {\n                        [types_1.CivicPassMessageAction.REFRESH]: {\n                            payload,\n                            requiresProofOfWalletOwnership: shouldRequestPowo,\n                        },\n                    } }) });\n        }\n        case 'civicPass_refresh_cancelled':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { refreshTokenState: types_1.RefreshTokenState.CANCELLED, gatewayStatus: types_1.GatewayStatus.REFRESH_TOKEN_REQUIRED });\n        case 'civicPass_refresh_failure':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { refreshTokenState: types_1.RefreshTokenState.FAILED, gatewayStatus: types_1.GatewayStatus.ERROR, civicPass: Object.assign(Object.assign({}, state.civicPass), { responsePayload: undefined }) });\n        case 'civicPass_location_not_supported':\n            return Object.assign(Object.assign({}, state), { iframeMinimized: true, renderIframe: false, gatewayStatus: state.gatewayStatus, refreshTokenState: state.gatekeeperRecordState === types_1.GatekeeperRecordState.ISSUED_LOCATION_NOT_SUPPORTED\n                    ? types_1.RefreshTokenState.REQUIRES_POWO\n                    : state.refreshTokenState });\n        case 'civicPass_vpn_not_supported':\n            return Object.assign(Object.assign({}, state), { iframeMinimized: true, renderIframe: false, gatewayStatus: state.gatewayStatus });\n        default:\n            return state;\n    }\n};\nexports.reducer = reducer;\nconst useCivicPass = ({ wallet }, state, dispatch) => {\n    const { gatekeeperRecordState } = state;\n    const getActionForIssuanceResponse = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageEventResult.SUCCESS]: {\n                type: 'civicPass_issuance_success',\n                payload: response,\n            },\n            [types_1.CivicPassMessageEventResult.FAILURE]: {\n                type: 'civicPass_issuance_failure',\n            },\n            [types_1.CivicPassMessageEventResult.CANCELLED]: {\n                type: 'civicPass_issuance_cancelled',\n            },\n            [types_1.CivicPassMessageEventResult.IN_PROGRESS]: {\n                type: 'civicPass_in_progress',\n            },\n        };\n        return actions[response.event];\n    };\n    const getActionForRefreshResponse = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageEventResult.SUCCESS]: {\n                type: 'civicPass_refresh_success',\n                payload: response,\n            },\n            [types_1.CivicPassMessageEventResult.CANCELLED]: {\n                type: 'civicPass_refresh_cancelled',\n            },\n            [types_1.CivicPassMessageEventResult.FAILURE]: {\n                type: 'civicPass_refresh_failure',\n            },\n        };\n        return actions[response.event];\n    };\n    const getActionForPowoResponse = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageEventResult.SUCCESS]: {\n                type: 'powoComplete',\n            },\n        };\n        return actions[response.event];\n    };\n    const getActionForLocationNotSupportedResponse = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageEventResult.SUCCESS]: {\n                type: 'civicPass_location_not_supported',\n            },\n        };\n        return actions[response.event];\n    };\n    const getActionForVpnNotSupportedResponse = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageEventResult.SUCCESS]: {\n                type: 'civicPass_vpn_not_supported',\n            },\n        };\n        return actions[response.event];\n    };\n    const getActionForStaticResponse = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageEventResult.SUCCESS]: {\n                type: 'civicPass_close',\n            },\n        };\n        return actions[response.event];\n    };\n    const getActionForStatusResponse = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageEventResult.SUCCESS]: {\n                type: 'civicPass_check_status_complete',\n                payload: response,\n            },\n        };\n        return actions[response.event];\n    };\n    const dispatchComplianceEventResult = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageAction.ISSUANCE]: getActionForIssuanceResponse(response),\n            [types_1.CivicPassMessageAction.PROOF_OF_WALLET_OWNERSHIP]: getActionForPowoResponse(response),\n            [types_1.CivicPassMessageAction.TOKEN_IN_REVIEW]: getActionForStaticResponse(response),\n            [types_1.CivicPassMessageAction.TOKEN_ACTIVE]: getActionForStaticResponse(response),\n            [types_1.CivicPassMessageAction.TOKEN_FROZEN]: getActionForStaticResponse(response),\n            [types_1.CivicPassMessageAction.TOKEN_REJECTED]: getActionForStaticResponse(response),\n            [types_1.CivicPassMessageAction.TOKEN_REVOKED]: getActionForStaticResponse(response),\n            [types_1.CivicPassMessageAction.FAILED_IP_CHECK]: getActionForLocationNotSupportedResponse(response),\n            [types_1.CivicPassMessageAction.FAILED_VPN_CHECK]: getActionForVpnNotSupportedResponse(response),\n            [types_1.CivicPassMessageAction.REFRESH]: getActionForRefreshResponse(response),\n            [types_1.CivicPassMessageAction.STATUS]: getActionForStatusResponse(response),\n        };\n        const action = actions[response.action];\n        if (action) {\n            logDebug('Successfully processed compliance event with action', action);\n            dispatch(action);\n        }\n    };\n    /**\n     * Listen for post messages from the compliance iframe and dispatch events\n     * based on the event type\n     */\n    (0, react_1.useEffect)(() => {\n        if (wallet && wallet.publicKey) {\n            logDebug('Current state', state);\n            const handler = async (response) => {\n                dispatchComplianceEventResult(response.data);\n            };\n            window.addEventListener('message', handler);\n            return () => {\n                logDebug('Removing event listener for compliance');\n                return window.removeEventListener('message', handler);\n            };\n        }\n        return () => { };\n    }, []);\n    /**\n     * We do not have a token and user is connecting from an unsupported country,\n     * so we show the country not supported screen\n     */\n    (0, react_1.useEffect)(() => {\n        if (gatekeeperRecordState === types_1.GatekeeperRecordState.LOCATION_NOT_SUPPORTED ||\n            gatekeeperRecordState === types_1.GatekeeperRecordState.VPN_NOT_SUPPORTED) {\n            dispatch({ type: 'civicPass_check_token_status' });\n        }\n    }, [gatekeeperRecordState]);\n    /**\n     * Check for the ongoing KYC status\n     */\n    (0, react_1.useEffect)(() => {\n        if (gatekeeperRecordState === types_1.GatekeeperRecordState.NOT_REQUESTED) {\n            dispatch({ type: 'civicPass_check_status' });\n        }\n    }, [gatekeeperRecordState]);\n    return { dispatchComplianceEventResult };\n};\nexports.default = useCivicPass;\n"]},"metadata":{},"sourceType":"script"}